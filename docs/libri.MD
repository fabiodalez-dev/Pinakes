# ğŸ“š Gestione Libri - Documentazione Ufficiale

## ğŸ“– PARTE 1: GUIDA PER L'UTENTE FINALE

### Ciao! Benvenuto nella Gestione Libri ğŸ‰

Questa pagina ti spiega **tutto quello che puoi fare** con i libri della tua biblioteca. Non serve essere tecnici!

### ğŸ¯ Cosa Puoi Fare Qui

| **Funzione** | **Serve per...** | **Quando usarla** |
|--------------|-------------------|-------------------|
| **ğŸ“š Lista Libri** | Vedere tutti i libri della biblioteca | Ogni giorno |
| **ğŸ” Ricerca** | Trovare un libro specifico | Quando ti serve |
| **â• Aggiungi Libro** | Inserire nuovi libri | Quando acquisti libri |
| **âœï¸ Modifica** | Cambiare informazioni | Quando trovi errori |
| **ğŸ·ï¸ Etichette** | Stampare codici per gli scaffali | Quando organizzi |
| **ğŸ“Š Esporta** | Salvare liste in Excel | Per inventari |

---

### ğŸš€ Come Entrare

1. **Vai su**: Dashboard â†’ **Libri**
2. **Oppure digita**: `localhost:8000/admin/libri`
3. **Vedrai**: Una grande tabella con tutti i libri!

---

### ğŸ” Come Cercare Libri (Facile!)

#### **Metodo 1: Ricerca Rapida**
- Scrivi **qualunque cosa** nella barra in alto
- Esempi: `Dante`, `Commedia`, `9788842935780`
- **Funziona per**: titolo, autore, ISBN, editore

#### **Metodo 2: Filtri Precisi**
Clicca su **"Filtri"** per usare:
- **DisponibilitÃ **: Solo libri liberi
- **Autore**: Tutti i libri di uno scrittore
- **Data**: Libri acquistati nel 2024
- **Genere**: Solo narrativa, saggistica, ecc.

---

### ğŸ“Š Leggere la Tabella (Semplice!)

| **Colonna** | **Cosa Significa** | **Esempio** |
|-------------|-------------------|-------------|
| ğŸŸ¢ğŸŸ¡ğŸ”´ | Stato del libro | ğŸŸ¢=Libero, ğŸ”´=Prestato |
| ğŸ“· | Copertina | Clicca per vedere grande |
| ğŸ“– | Titolo + Autore | "Divina Commedia - Dante" |
| ğŸ·ï¸ | Posizione fisica | "A.2.15" = Scaffale A, Mensola 2, Posizione 15 |
| ğŸ“… | Anno | Quando Ã¨ stato pubblicato |
| âš™ï¸ | Azioni | Cosa puoi fare |

---

### â• Aggiungere un Nuovo Libro

#### **Metodo A: Automatico (Consigliato)**
1. Clicca **"+ Nuovo Libro"**
2. Trova l'**ISBN** sul retro del libro (13 cifre)
3. Digita l'ISBN e clicca **"Importa"**
4. **Magia!** Il sistema trova:
   - Titolo completo âœ“
   - Autore/i âœ“
   - Copertina âœ“
   - Descrizione âœ“
   - Prezzo âœ“

#### **Metodo B: Manuale**
1. Clicca **"+ Nuovo Libro"**
2. Compila i campi:
   - **Titolo** (obbligatorio)
   - **Autore** (puoi crearne di nuovi)
   - **Posizione** (scaffale/mensola)
3. Carica copertina (se vuoi)
4. Salva!

> ğŸ“š **Vuoi i dettagli?** Leggi la [Guida Completa Inserimento Libri](/docs/inserimento_libri.MD) con tutti i campi spiegati, lo scraping automatico e 4 esempi pratici.

---

### âœï¸ Modificare un Libro Esistente

1. **Trova** il libro nella tabella
2. **Clicca** l'icona âœï¸ nella riga
3. **Cambia** solo ciÃ² che serve:
   - Titolo sbagliato? Correggi
   - Autore mancante? Aggiungi
   - Posizione cambiata? Aggiorna
4. **Salva** e fatto!

> âš ï¸ **Nota**: Se il libro Ã¨ in prestito, alcuni campi sono bloccati per sicurezza.

> ğŸ“š **Vuoi i dettagli?** Leggi la [Guida Modifica Libro](/docs/modifica_libro.MD) con 8 passi completi, 5 casi reali e tutte le soluzioni ai problemi comuni.

---

### ğŸ·ï¸ Stampare le Etichette

Le etichette servono per **trovare i libri sugli scaffali**.

#### **Procedura**
1. Clicca sul **titolo del libro** nella tabella
2. Clicca **"Stampa Etichetta"**
3. **PDF** pronto! Contiene:
   - Nome della biblioteca
   - Titolo abbreviato
   - Autore
   - Posizione (es. A.2.15)
   - Codice a barre

#### **Formati Disponibili**
- **25Ã—38mm**: Standard per dorso libri
- **50Ã—25mm**: Orizzontale
- **70Ã—36mm**: Grande

> ğŸ“š **Vuoi i dettagli?** Leggi la [Guida Stampa Etichette](/docs/stampa_etichette.MD) con come configurare il formato, dove comprare la carta, istruzioni di stampa e come applicarle.

---

### ğŸ‘ï¸ Vedere i Dettagli di un Libro

1. **Clicca** sul titolo del libro
2. **Vedrai**:
   - Copertina grande
   - Tutte le informazioni
   - Storico prestiti
   - Bottoni per modificare

> ğŸ“š **Vuoi i dettagli?** Leggi la [Guida Scheda Libro](/docs/scheda_libro.MD) che spiega le 10 sezioni della scheda, i bottoni disponibili e come navigare tra modifica, stampa e visualizzazione.

---

### ğŸ“¤ Esportare la Lista

1. **Applica** i filtri (se vuoi)
2. **Clicca** i bottoni in alto:
   - **CSV**: Per Excel
   - **PDF**: Per stampare
   - **STAMPA**: Diretta

---

### ğŸ—‘ï¸ Eliminare un Libro

> âš ï¸ **Attenzione**: L'eliminazione Ã¨ **permanente**

1. Trova il libro
2. Clicca ğŸ—‘ï¸
3. **Conferma** nel popup

> **Non puoi eliminare** se:
> - Il libro Ã¨ in prestito
> - Ha prestiti non restituiti

---

### â“ Domande Frequenti

**Q: PerchÃ© alcuni libri non hanno la copertina?**
- Puoi aggiungerla manualmente
- Alcune copertine non sono online

**Q: Come so se un libro Ã¨ disponibile?**
- Guarda il pallino: ğŸŸ¢=libero, ğŸ”´=prestato

**Q: Posso modificare piÃ¹ libri insieme?**
- No, uno alla volta per sicurezza

---

## ğŸ”§ PARTE 2: DOCUMENTAZIONE TECNICA PER SVILUPPATORI

### Architettura del Sistema

#### Stack Tecnologico
- **Backend**: PHP 8.1+ (Slim 4 Framework)
- **Database**: MySQL 8.0+ con InnoDB
- **Frontend**: Vanilla JavaScript + DataTables
- **PDF**: TCPDF per etichette
- **API**: RESTful endpoints

#### Pattern Architetturali
- **MVC**: Model-View-Controller
- **Repository Pattern**: Isolamento logica database
- **Service Layer**: Business logic
- **CSRF Protection**: Token validation
- **Prepared Statements**: SQL Injection protection

---

### Struttura File

```
app/
â”œâ”€â”€ Controllers/
â”‚   â”œâ”€â”€ LibriController.php      # CRUD operations
â”‚   â”œâ”€â”€ LibriApiController.php   # DataTables API
â”‚   â””â”€â”€ ScrapeController.php     # ISBN scraping
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ BookRepository.php       # Database operations
â”‚   â”œâ”€â”€ AuthorRepository.php     # Author management
â”‚   â””â”€â”€ CollocationRepository.php # Position system
â”œâ”€â”€ Views/
â”‚   â””â”€â”€ libri/
â”‚       â”œâ”€â”€ index.php            # DataTables view
â”‚       â”œâ”€â”€ crea_libro.php       # Create form
â”‚       â”œâ”€â”€ modifica_libro.php   # Edit form
â”‚       â””â”€â”€ scheda_libro.php     # Details view
```

---

### Database Schema

#### Tabella `libri`
```sql
CREATE TABLE libri (
    id INT AUTO_INCREMENT PRIMARY KEY,
    titolo VARCHAR(255) NOT NULL,
    sottotitolo VARCHAR(500),
    isbn10 VARCHAR(10),
    isbn13 VARCHAR(13),
    ean VARCHAR(13),
    editore_id INT NULL,
    data_pubblicazione VARCHAR(100),
    numero_pagine INT,
    formato VARCHAR(50),
    lingua VARCHAR(50),
    peso DECIMAL(6,3),
    dimensioni VARCHAR(50),
    prezzo DECIMAL(8,2),
    data_acquisizione DATE,
    tipo_acquisizione VARCHAR(100),
    numero_inventario VARCHAR(100),
    collana VARCHAR(200),
    numero_serie INT,
    categoria_id INT NULL,
    genere_id INT NULL,
    sottogenere_id INT NULL,
    classificazione_dowey VARCHAR(50),
    descrizione TEXT,
    parole_chiave TEXT,
    note_varie TEXT,
    copie_totali INT DEFAULT 1,
    copie_disponibili INT DEFAULT 1,
    stato ENUM('Disponibile','Prestato','Riservato','Danneggiato','Perso','In_Riparazione','Non_Disponibile') DEFAULT 'Disponibile',
    scaffale_id INT NULL,
    mensola_id INT NULL,
    posizione_progressiva INT NULL,
    collocazione VARCHAR(50),
    copertina_url VARCHAR(500),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (editore_id) REFERENCES editori(id) ON DELETE SET NULL,
    FOREIGN KEY (scaffale_id) REFERENCES scaffali(id) ON DELETE SET NULL,
    FOREIGN KEY (mensola_id) REFERENCES mensole(id) ON DELETE SET NULL,
    INDEX idx_isbn13 (isbn13),
    INDEX idx_isbn10 (isbn10),
    INDEX idx_titolo (titolo),
    INDEX idx_stato (stato),
    INDEX idx_collocazione (scaffale_id, mensola_id, posizione_progressiva)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

#### Tabella `libri_autori` (Relazione Many-to-Many)
```sql
CREATE TABLE libri_autori (
    id INT AUTO_INCREMENT PRIMARY KEY,
    libro_id INT NOT NULL,
    autore_id INT NOT NULL,
    ordine INT DEFAULT 0,
    FOREIGN KEY (libro_id) REFERENCES libri(id) ON DELETE CASCADE,
    FOREIGN KEY (autore_id) REFERENCES autori(id) ON DELETE CASCADE,
    UNIQUE KEY unique_libro_autore (libro_id, autore_id),
    INDEX idx_libro (libro_id),
    INDEX idx_autore (autore_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

### API Endpoints

#### GET `/api/libri`
Server-side processing per DataTables con filtri avanzati.

**Parametri Query**:
```javascript
{
  draw: number,           // DataTables counter
  start: number,          // Pagination offset
  length: number,         // Records per page
  search: { value: string }, // Global search
  order: [{column: number, dir: 'asc'|'desc'}],
  
  // Custom filters
  search_text: string,
  search_isbn: string,
  stato_filter: string,
  autore_id: number,
  editore_filter: number,
  genere_filter: number,
  posizione_id: number,
  date_range: object
}
```

**Response**:
```json
{
  "draw": 1,
  "recordsTotal": 1500,
  "recordsFiltered": 45,
  "data": [
    {
      "id": 123,
      "titolo": "La Divina Commedia",
      "autori": [{"id": 1, "nome": "Dante Alighieri"}],
      "editore_nome": "Mondadori",
      "stato": "Disponibile",
      "collocazione": "A.2.15",
      "copertina_url": "/uploads/copertine/123.jpg"
    }
  ]
}
```

#### GET `/api/scrape/isbn`
Scraping informazioni libro da fonti esterne.

**Parametri**: `isbn` (string)
**Response**: JSON con dati libro o errore 404

---

### Sicurezza e Performance

#### Protezioni Implementate
- **SQL Injection**: Prepared statements
- **XSS**: `htmlspecialchars()` su tutti gli output
- **CSRF**: Token validation
- **File Upload**: MIME type validation
- **SSRF**: Domain whitelist per scraping

#### Performance Optimization
```sql
-- Indici critici per performance
CREATE INDEX idx_composite_search ON libri(stato, editore_id, genere_id);
CREATE INDEX idx_isbn_search ON libri(isbn13, isbn10, ean);
CREATE INDEX idx_title_fulltext ON libri(titolo) USING FULLTEXT;
```

#### Caching Strategy
- **APCu caching** per liste statiche
- **Database query cache** per ricerche frequenti
- **Image optimization** per copertine

---

### Testing e Debugging

#### PHPUnit Tests
```php
class BookRepositoryTest extends TestCase
{
    public function testCreateBook(): void
    {
        $data = [
            'titolo' => 'Test Book',
            'isbn13' => '9781234567890',
            'copie_totali' => 3,
            'copie_disponibili' => 3
        ];
        
        $bookId = $repo->create($data);
        $this->assertGreaterThan(0, $bookId);
    }
}
```

#### Debug Console
```bash
# Verifica API
curl -X GET "http://localhost:8000/api/libri?length=10"

# Verifica scraping
curl -X GET "http://localhost:8000/api/scrape/isbn?isbn=9788842935780"

# Log errors
tail -f storage/logs/app.log
```

---

## ğŸ“š INDICE COMPLETO DELLE GUIDE

### Guide Dettagliate per Ogni Operazione

| **Operazione** | **Guida Completa** | **Tempo di Lettura** |
|----------------|-------------------|---------------------|
| â• Aggiungere un libro | [Guida Inserimento Libri](/docs/inserimento_libri.MD) | 15 min |
| âœï¸ Modificare un libro | [Guida Modifica Libro](/docs/modifica_libro.MD) | 10 min |
| ğŸ‘ï¸ Visualizzare i dettagli | [Guida Scheda Libro](/docs/scheda_libro.MD) | 8 min |
| ğŸ·ï¸ Stampare etichette | [Guida Stampa Etichette](/docs/stampa_etichette.MD) | 10 min |
| ğŸ“ Organizzare scaffali | [Guida Collocazione](/docs/collocazione.MD) | 12 min |
| ğŸ“• Gestire prestiti | [Guida Prestiti](/docs/prestiti.MD) | 10 min |

### Argomenti Approfonditi

- **Scraping Automatico**: Come il sistema recupera automaticamente i dati da ISBN/EAN â†’ vedi [Guida Inserimento Libri - Sezione Scraping](/docs/inserimento_libri.MD#-come-funziona-lo-scraping-automatico)

- **Classificazione Dewey**: Come classificare i libri per argomento â†’ vedi [Guida Inserimento Libri - Sezione Dewey](/docs/inserimento_libri.MD#-classificazione-dewey-dewey-decimal-classification)

- **Impostazioni Etichette**: Come configurare formati e tipo di carta â†’ vedi [Guida Stampa Etichette - Sezione Configurazione](/docs/stampa_etichette.MD#-configurare-il-formato-etichette)

---

## ğŸ¯ Quick Start per Utente Finale

**Vuoi aggiungere subito un libro?**
1. Vai a **Dashboard â†’ Libri**
2. Clicca **"+ Nuovo Libro"**
3. Digita l'ISBN e clicca "Importa"
4. Assegna la posizione fisica
5. Clicca "Salva"
6. âœ… Fatto! â†’ Stampa etichetta e applica

> ğŸ’¡ Se hai dubbi, consulta una delle guide correlate qui sopra!

---

*Ultimo aggiornamento: 19 Ottobre 2025*
*Versione documentazione: 4.0.0*
*Versione guide correlate: 3.0.0* ğŸ‰
