# ğŸ“§ Guida Email e Notifiche - Sistema Biblioteca

## ğŸ¯ Introduzione Semplice

Il sistema invia **automaticamente email** quando accadono cose importanti nella biblioteca:
- ğŸ“ Quando un utente si registra
- âœ… Quando un account viene approvato
- ğŸ“š Quando un prestito sta per scadere
- âš ï¸ Quando un prestito Ã¨ in ritardo
- ğŸ‰ Quando un libro desiderato torna disponibile

**Non devi fare nulla** - tutto accade in automatico! ğŸ¤–

---

## ğŸ“‹ Tipi di Email Inviate Automaticamente

### 1ï¸âƒ£ Email di Registrazione
**Chi la riceve?** â†’ Nuovo utente che si registra
**Cosa dice?** â†’ "Ciao! Grazie per esserti registrato. Il tuo account Ã¨ in attesa di approvazione dall'amministratore."

---

### 2ï¸âƒ£ Email di Approvazione Account
**Chi la riceve?** â†’ Utente appena approvato
**Cosa dice?** â†’ "ğŸ‰ Accettato! Ecco il tuo codice tessera e puoi accedere subito"

---

### 3ï¸âƒ£ Email Avviso Scadenza Prestito
**Chi la riceve?** â†’ Utente con prestito scadente (3 giorni prima)
**Cosa dice?** â†’ "â° Attenzione! Il libro scade tra 3 giorni. Puoi rinnovare cliccando qui"

---

### 4ï¸âƒ£ Email Prestito Scaduto
**Chi la riceve?** â†’ Utente con libro in ritardo
**Cosa dice?** â†’ "ğŸš¨ Urgente! Il libro Ã¨ scaduto. Hai una multa di Xâ‚¬ al giorno"

---

### 5ï¸âƒ£ Email Libro Desiderato Disponibile
**Chi la riceve?** â†’ Utente che aveva messo il libro nella lista desideri
**Cosa dice?** â†’ "ğŸ‰ Buone notizie! Il libro che volevi Ã¨ disponibile! Hai 24 ore per prenotarlo"

---

### 6ï¸âƒ£ Email Prenotazione Pronta
**Chi la riceve?** â†’ Utente che ha prenotato un libro
**Cosa dice?** â†’ "ğŸ“¦ Il tuo libro Ã¨ pronto! Vieni a ritirarlo entro 5 giorni"

---

### 7ï¸âƒ£ Email per Admin - Nuova Registrazione
**Chi la riceve?** â†’ Amministratore della biblioteca
**Cosa dice?** â†’ "Un nuovo utente si Ã¨ registrato. Clicca qui per approvare"

---

### 8ï¸âƒ£ Email per Admin - Richiesta Prestito
**Chi la riceve?** â†’ Amministratore della biblioteca
**Cosa dice?** â†’ "Un utente ha richiesto un libro. Clicca qui per approvare"

---

## ğŸ¨ Personalizzare le Email (Tab "Template" in Impostazioni)

### ğŸ“ Dove trovare questa sezione
**Dashboard** â†’ **Impostazioni** â†’ **Tab "Template"** (terzo tab in alto)

### Cosa puoi fare qui?

In questo tab potrai **personalizzare completamente le email** che il sistema invia automaticamente:

- âœï¸ **Oggetto email** (il titolo che vede il destinatario nella inbox)
- ğŸ“ **Corpo email** (il messaggio vero e proprio)
- ğŸ¨ **Formattazione** (grassetto, corsivo, colori, link)
- ğŸ”— **Link dinamici** (che si aggiornano automaticamente)

### ğŸ“§ Le Email Personalizzabili

Il sistema ti offre **8 template email** che puoi modificare:

| **#** | **Email** | **Quando viene inviata** | **Chi la riceve** |
|-------|-----------|-------------------------|-------------------|
| 1ï¸âƒ£ | Registrazione | Nuovo utente si registra | Nuovo utente |
| 2ï¸âƒ£ | Approvazione Account | Admin approva l'account | Utente approvato |
| 3ï¸âƒ£ | Scadenza Prestito (3 giorni) | 3 giorni prima della scadenza | Utente che ha il libro |
| 4ï¸âƒ£ | Prestito Scaduto | Dopo la data di scadenza | Utente con ritardo |
| 5ï¸âƒ£ | Libro Desiderato Disponibile | Un libro richiesto torna disponibile | Utente che lo voleva |
| 6ï¸âƒ£ | Prenotazione Pronta | Il libro prenotato Ã¨ disponibile | Utente che ha prenotato |
| 7ï¸âƒ£ | Admin - Nuova Registrazione | Nuovo utente si registra | Amministratore |
| 8ï¸âƒ£ | Admin - Richiesta Prestito | Utente richiede un libro | Amministratore |

### ğŸ”§ Come Personalizzare un Template

#### **Step 1: Scegliere l'Email**
1. Scorri verso il basso nel tab "Template"
2. Troverai **8 sezioni**, una per ogni tipo di email
3. Seleziona quella che vuoi modificare

#### **Step 2: Modificare l'Oggetto**
```
Campo "Oggetto":
Questo Ã¨ il titolo che vede il destinatario nella sua inbox.

Esempio PRIMA:
"Registrazione - Biblioteca Civica"

Esempio DOPO:
"Benvenuto! La tua registrazione Ã¨ stata ricevuta"
```

#### **Step 3: Modificare il Corpo Email**
```
Campo "Corpo email":
Questo Ã¨ il messaggio vero e proprio.
Usa l'editor visuale (simile a Word) per:
- Scrivere il testo
- Formattare (grassetto, corsivo, sottolineato)
- Aggiungere link
- Modificare colori
```

### ğŸ”‘ Segnaposti (Variabili Intelligenti)

Ogni template ha **segnaposti** che il sistema riempie automaticamente.

**Cosa vuol dire?** Il sistema sostituisce questi marcatori con i dati reali:

| **Segnaposto** | **Diventa** | **Esempio** |
|------------|----------|------------|
| `{{user_name}}` | Nome dell'utente | Mario Rossi |
| `{{book_title}}` | Titolo del libro | "La Divina Commedia" |
| `{{due_date}}` | Data di scadenza | 25/10/2025 |
| `{{app_name}}` | Nome della biblioteca | Biblioteca ITIS Marconi |
| `{{library_address}}` | Indirizzo della biblioteca | Via Roma 123, Milano |

**Quando usi questi segnaposti:**
- L'email di registrazione dirÃ : "Ciao Mario Rossi!" (non "Ciao {{user_name}}")
- L'email di scadenza dirÃ : "Il libro 'La Divina Commedia' scade il 25/10/2025"
- Ecc.

### ğŸ’¡ Esempio Pratico di Personalizzazione

**Scenario**: Vuoi che le email dicano "Biblioteca ITIS Marconi" anzichÃ© il nome generico.

**Soluzione**:
1. **Apri il Tab "Template"** in Impostazioni
2. **Seleziona il primo template** (Registrazione)
3. **Nel campo "Corpo email"**:
   - Cerca il testo: `{{app_name}}`
   - Ãˆ giÃ  lÃ¬! Sistema lo sostituirÃ  automaticamente
4. **Per cambiare il nome della biblioteca**:
   - **Non modifica qui il template**
   - **Vai in Impostazioni â†’ Tab "IdentitÃ "**
   - **Cambia il "Nome applicazione"** in "Biblioteca ITIS Marconi"
   - Tutte le email userannno quel nome automaticamente!

### âœ¨ Best Practices per i Template

#### âœ… **Fai cosÃ¬:**
- âœ… Usa i segnaposti forniti (`{{user_name}}`, `{{book_title}}`, ecc.)
- âœ… Mantieni il tono professionale ma amichevole
- âœ… Includi un link di aiuto (es: "Hai domande? Contattaci")
- âœ… Metti il numero di telefono/email della biblioteca
- âœ… Testa il template prima di salvare (invia una prova a te stesso)

#### âŒ **Evita:**
- âŒ Non rimuovere i segnaposti (le email sarebbero generiche)
- âŒ Non scrivere TUTTO IN MAIUSCOLO (sembra un urlo)
- âŒ Non mettere link strani o sospetti
- âŒ Non fare template troppo lunghi (piÃ¹ di 500 parole)
- âŒ Non cambiare il template ogni giorno (confonde gli utenti)

### ğŸ§ª Testare i Template

**Come vedere come appare davvero l'email:**

1. **Personalizza il template** come vuoi
2. **Clicca "Salva template"** in basso
3. **Vai in Impostazioni â†’ Tab "Email"**
4. **Clicca "Test Email"** (se disponibile)
5. **Seleziona il tipo di email** che vuoi testare
6. **Metti la tua email** nel campo test
7. **Clicca "Invia"**
8. **Controlla la tua inbox** (o spam)

CosÃ¬ vedrai esattamente come gli utenti riceveranno l'email!

### ğŸ“‹ Esempi di Template Personalizzati

#### **Esempio 1: Email di Registrazione Accogliente**
```
Oggetto:
"ğŸ‰ Benvenuto! {{user_name}} - Registrazione ricevuta"

Corpo:
Ciao {{user_name}},

Grazie per esserti registrato in {{app_name}}!

Il tuo account Ã¨ in fase di revisione. L'amministratore lo
approverÃ  entro 24 ore.

Nel frattempo, puoi sfogliare il nostro catalogo di libri:
[Link al catalogo]

Se hai domande:
ğŸ“§ {{app_email}}
ğŸ“ {{app_phone}}

A presto!
La squadra di {{app_name}}
```

#### **Esempio 2: Email di Scadenza con Tono Amichevole**
```
Oggetto:
"â° Ultimi 3 giorni per '{{book_title}}'"

Corpo:
Ciao {{user_name}},

Tra 3 giorni il tuo prestito di "{{book_title}}" scade
(scadenza: {{due_date}}).

Non dimenticarti di restituire il libro! Se non hai finito,
puoi rinnovare il prestito cliccando qui:
[Link a rinnova prestito]

Domande? Contattaci!
```

---

## âš™ï¸ Configurazione Email (Tab "Email" in Impostazioni)

### ğŸ“ Dove trovare questa sezione
**Dashboard** â†’ **Impostazioni** â†’ **Tab "Email"** (secondo tab in alto)

### Come Funziona?
Il sistema ha bisogno di un "postino" per spedire le email. Questo postino si chiama **server SMTP** (un computer specializzato che invia email).

### Scegliere il Metodo di Invio

Nella sezione "Configurazione invio" troverai **3 opzioni**:

#### **Opzione 1: PHP mail()** (Semplice ma meno affidabile)
```
âœ… Pro:
- Configurazione minima
- Non serve account esterno
- Veloce

âŒ Contro:
- Spesso finisce nello spam
- Dipende dal server
```
**Quando usarlo?** Solo per test, non consigliato in produzione

---

#### **Opzione 2: PHPMailer** (Intermedio)
```
âœ… Pro:
- AffidabilitÃ  media
- Buon compromesso

âŒ Contro:
- Configurazione nel codice (non in interfaccia)
- Meno flessibile
```
**Quando usarlo?** Se il tuo hosting lo supporta e gestisce automaticamente la configurazione

---

#### **Opzione 3: SMTP Personalizzato** (CONSIGLIATO â­)
```
âœ… Pro:
- Massima affidabilitÃ 
- Configurabile dall'interfaccia
- Email non finiscono nello spam
- Funziona sempre

âŒ Contro:
- Serve un account email (Gmail, PEC, server scolastico)
```
**Quando usarlo?** SEMPRE se possibile. Ãˆ la scelta migliore.

### ğŸ“‹ I Campi Obbligatori

Qualunque metodo scegli, dovrai compilare questi campi:

| **Campo** | **Cosa inserire** | **Esempio** |
|-----------|-------------------|------------|
| **Mittente (email)** | Email da cui spedire | `biblioteca@scuola.it` |
| **Mittente (nome)** | Nome che vede il destinatario | `Biblioteca ITIS Marconi` |

### ğŸ”§ Configurazione Server SMTP (Se scegli "SMTP Personalizzato")

Dopo aver selezionato **"SMTP personalizzato"**, compariranno questi campi:

| **Campo** | **Dove trovarlo** | **Esempio** |
|-----------|-------------------|------------|
| **Host** | Nome del server mail | `smtp.gmail.com` |
| **Porta** | Numero porta di connessione | `587` (standard) o `465` (SSL) |
| **Username** | Email dell'account | `biblioteca@gmail.com` |
| **Password** | Password account | `abc123def456` (o password app) |
| **Crittografia** | Tipo di sicurezza | `TLS` (consigliato) |

### ğŸ“Œ Provider PiÃ¹ Comuni - Dati da Usare

#### **Gmail** (Gratuito - CONSIGLIATO)
```
Host: smtp.gmail.com
Porta: 587
Crittografia: TLS
Username: tua-email@gmail.com
Password: [Password App generata in Impostazioni Google]

âš ï¸ IMPORTANTE: Con Gmail devi creare una "Password app":
1. Vai su https://myaccount.google.com/security
2. Attiva "Verifica in 2 passaggi"
3. Torna a Security e cerca "App passwords"
4. Genera password per "Mail" e "Windows"
5. Copia quella generata e usala qui
```

#### **Server Scolastico** (Dipende da scuola)
```
Chiedi al tuo amministratore IT i dati di connessione:
- Host: [chiedi all'admin]
- Porta: [chiedi all'admin]
- Username: [la tua email scolastica]
- Password: [la tua password scolastica]
- Crittografia: [chiedi all'admin]

Questo Ã¨ diverso da scuola a scuola, non c'Ã¨ uno standard.
```

#### **PEC (Raccomandata Digitale)** (PiÃ¹ formale)
```
Host: smtps.pec.aruba.it (Aruba) / smtps.pec.it (altri provider)
Porta: 465
Crittografia: SSL
Username: [la tua email PEC]
Password: [la tua password PEC]

Nota: PEC ha costi di registrazione (~â‚¬10-20/anno)
```

#### **Outlook/Hotmail** (Se usi Microsoft)
```
Host: smtp-mail.outlook.com
Porta: 587
Crittografia: TLS
Username: tua-email@outlook.com
Password: [la tua password]
```

### âœ… Testare la Configurazione

**Come verificare che funziona:**

1. **Compila tutti i campi** con i dati del tuo provider
2. **Clicca "Salva impostazioni email"** in basso
3. **Torna nella sezione Email**
4. **Clicca il pulsante verde "Test Connessione"** (se presente)
5. **Attendi il risultato**:
   - âœ… **Verde**: Configurazione OK! Le email partiranno
   - âŒ **Rosso**: Controlla dati (host, porta, credenziali)

**Se il test non passa:**
- Verifica che l'email e password siano corretti
- Verifica il nome host (copialo esattamente dal provider)
- Verifica la porta (587 per TLS, 465 per SSL)
- Se usi Gmail, assicurati di usare una "password app" non la password normale
- Contatta il supporto del provider email

---

## ğŸ§ª Testare le Email

### Test Veloce
1. **Dashboard** â†’ **Impostazioni** â†’ **Email**
2. **Clicca**: "Invia Email di Prova"
3. **Seleziona**: Il tipo di email
4. **Metti**: La tua email personale
5. **Clicca**: "Invia"
6. **Controlla**: La tua posta

### Cosa Controllare?
- âœ… Ricevi l'email in pochi secondi?
- âœ… Il design Ã¨ quello che volevi?
- âœ… I dati sono corretti (nome, data, ecc.)?
- âœ… I link funzionano?

---

## ğŸ” Problema: Email non Ricevute?

### Checklist Rapida

#### 1. Verifica Configurazione SMTP
```
Dashboard â†’ Impostazioni â†’ Email
Controlla che tutti i dati siano compilati
```

#### 2. Verifica Indirizzo Email
```
Email corretta?
Es. mario@example.com (sÃ¬)
Es. mario@.com (no - incompleta)
```

#### 3. Controlla lo Spam
```
Controlla anche la cartella SPAM/Posta Indesiderata
A volte le email finiscono lÃ¬ per sbaglio
```

#### 4. Prova a Inviare Email di Test
```
Dashboard â†’ Impostazioni â†’ Email â†’ "Test Email"
Se il test non funziona, il problema Ã¨ nella configurazione
```

### Se Ancora Non Funziona?
- âœ… Contatta l'amministratore del sistema
- âœ… Mostragli il messaggio di errore (se c'Ã¨)
- âœ… Digli il provider che stai usando (Gmail, PEC, ecc.)

---

## ğŸ“Š Statistiche Email (Facoltativo)

### Dove Vederle?
1. **Dashboard** â†’ **Impostazioni** â†’ **Email**
2. **Sezione**: "Statistiche Email"

### Cosa Significano?

| **Metrica** | **Cosa Ã¨** | **Cosa Significa** |
|-------------|-----------|-------------------|
| **Inviate oggi** | Numero email spedite | Quante email ha mandato il sistema oggi |
| **In coda** | Email in attesa | Quante email devono ancora essere spedite |
| **Consegnate** | Email ricevute | Quante hanno raggiunto la destinazione |
| **Errori** | Email fallite | Quante non sono riuscite a partire |

> ğŸ’¡ Se gli errori sono pochi (< 5%) Ã¨ normale. Se sono molti (> 20%), c'Ã¨ un problema con la configurazione.

---

## ğŸ¯ Variabili Intelligenti (Per Admin Avanzati)

Le email hanno dei "marcatori" che si riempiono automaticamente:

| **Marcatore** | **Diventa** | **Esempio** |
|---------------|-----------|------------|
| `{user_name}` | Nome utente | Mario Rossi |
| `{book_title}` | Titolo libro | La Divina Commedia |
| `{due_date}` | Data scadenza | 25/10/2025 |
| `{app_name}` | Nome biblioteca | Biblioteca ITIS Marconi |
| `{library_address}` | Indirizzo | Via Roma 123, Milano |

**Puoi usarli** quando personalizzi i template. Il sistema li "compila" automaticamente per ogni email!

---

## ğŸ“š Best Practices (Suggerimenti)

### âœ… Cose da Fare
- âœ… Testa sempre le email prima di usarle in produzione
- âœ… Personalizza il nome della biblioteca (piÃ¹ professionale)
- âœ… Aggiungi il logo della scuola (riconoscibilitÃ )
- âœ… Includi un numero di telefono (gli utenti devono poter contattarti)
- âœ… Controlla regolarmente la posta in uscita (feedback)

### âŒ Cose da Evitare
- âŒ Non cambiare le email ogni giorno (confonde gli utenti)
- âŒ Non usare colori strani o layout complicati
- âŒ Non includere link pericolosi
- âŒ Non inviare troppe email (spam!)

---

## ğŸ’¡ Consigli per Evitare Spam

### Il Sistema Automaticamente...
- âœ… Non invia email a utenti inesistenti
- âœ… Non invia lo stesso messaggio 100 volte
- âœ… Controlla che gli indirizzi siano validi
- âœ… Usa un provider affidabile (Gmail, PEC, ecc.)

### Tu Devi...
- âœ… Mantenere il design "pulito" e professionale
- âœ… Non scrivere TUTTO IN MAIUSCOLO
- âœ… Non fare link strani o sospetti
- âœ… Non cambiare subject ogni giorno

---

## ğŸš€ Quick Start - Setup Email (5 minuti)

### Passo 1: Prepara le Credenziali
```
Scegli uno tra:
- Account Gmail (piÃ¹ facile)
- Server scolastico (se disponibile)
- Servizio PEC (piÃ¹ formale)

Raccogli: email, password (o password app), host, port
```

### Passo 2: Accedi alle Impostazioni
```
Dashboard â†’ Impostazioni â†’ Email o Notifiche
```

### Passo 3: Riempi i Campi
```
Provider: [Gmail / PEC / Altro]
Email mittente: [la tua email]
Password: [la tua password]
Host SMTP: [dipende dal provider]
Port: [solitamente 587 o 465]
```

### Passo 4: Testa
```
Clicca: "Testa Connessione"
Attendi: âœ… Connessione riuscita!
```

### Passo 5: Personalizza (Opzionale)
```
Dashboard â†’ Impostazioni â†’ Email â†’ Template
Cambia nome biblioteca, logo, contatti
```

### Passo 6: âœ… Fatto!
```
Le email partono automaticamente ora!
```

---

## ğŸ“ Supporto e Aiuto

### Se Hai Dubbi
1. **Leggi questa guida** - risponde alla maggior parte delle domande
2. **Prova il test email** - il sistema ti dirÃ  se c'Ã¨ un problema
3. **Controlla lo spam** - a volte finiscono lÃ¬ per sbaglio
4. **Contatta il supporto** - se non riesci da solo

### Info Utili da Avere Quando Chiedi Aiuto
- Quale provider usi? (Gmail, PEC, server scuola?)
- Qual Ã¨ il messaggio di errore esatto?
- Quando ha smesso di funzionare? (oggi? una settimana fa?)

---

## ğŸ‰ Risultato Finale

Dopo il setup, il sistema automaticamente:

âœ… Invia email di benvenuto ai nuovi utenti
âœ… Notifica quando gli account vengono approvati
âœ… Avvisa prima della scadenza prestiti
âœ… Ricorda i prestiti in ritardo
âœ… Segnala libri desiderati disponibili
âœ… Comunica con gli amministratori

**Tutto senza che tu debba fare nulla!** ğŸ¤–

---

## ğŸ“š Guide Correlate

- [Guida Impostazioni](/docs/settings.MD) - Configurazione generale del sistema (dove si trovano Tab Email e Template)
- [Guida Prestiti](/docs/prestiti.MD) - Gestione prestiti (che triggera automaticamente le email)
- [Guida Libri](/docs/libri.MD) - Gestione del catalogo libri

---

**ğŸ“– Documento aggiornato: 19 Ottobre 2025**
**ğŸ“Œ Versione: 3.0.0 - Con Tab Email e Template dettagliati**
**âœï¸ Linguaggio chiaro e diretto per utenti finali**
